<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulaire de Tâche</title>
    <link rel="stylesheet" href="3C_style.css">
    <script>
        // Variables JavaScript avec données JSON
        let listeTaches = [
        {
                "idTache": 1,
                "libelle": "Réviser le cours de JavaScript",
                "description": "Revoir les concepts de base et faire les exercices",
                "dateCreation": "2024-01-15",
                "dateEcheance": "2024-01-20",
                "localisation": "A distance",
                "idStatut": 2,
                "idPriorite": 2,
                "idCategorie": 3,
                "idDifficulte": 3
        },
        {
                "idTache": 2,
                "libelle": "Faire les courses",
                "description": "Acheter les ingrédients pour le dîner de demain",
                "dateCreation": "2024-01-16",
                "dateEcheance": "2024-01-17",
                "localisation": "Au marché",
                "idStatut": 1,
                "idPriorite": 3,
                "idCategorie": 2,
                "idDifficulte": 1
        },
        {
                "idTache": 3,
                "libelle": "Préparer présentation projet",
                "description": "Créer les slides et répéter la présentation",
                "dateCreation": "2024-01-14",
                "dateEcheance": "2024-01-22",
                "localisation": "Studium",
                "idStatut": 4,
                "idPriorite": 1,
                "idCategorie": 1,
                "idDifficulte": 2
        }
];
        
        let listePriorites = [
        {
                "idPriorite": 1,
                "priorite": "Importante"
        },
        {
                "idPriorite": 2,
                "priorite": "Moyenne"
        },
        {
                "idPriorite": 3,
                "priorite": "Peu importante"
        },
        {
                "idPriorite": 4,
                "priorite": "Optionnelle"
        }
];
        
        let listeStatuts = [
        {
                "idStatut": 1,
                "statut": "En attente"
        },
        {
                "idStatut": 2,
                "statut": "En cours"
        },
        {
                "idStatut": 3,
                "statut": "Urgent"
        },
        {
                "idStatut": 4,
                "statut": "Terminée"
        },
        {
                "idStatut": 5,
                "statut": "Annulée"
        }
];
        
        let listeCategories = [
        {
                "idCategorie": 1,
                "categorie": "Travail"
        },
        {
                "idCategorie": 2,
                "categorie": "Maison"
        },
        {
                "idCategorie": 3,
                "categorie": "Études"
        },
        {
                "idCategorie": 4,
                "categorie": "Loisirs"
        }
];
        
        let listeDifficultes = [
        {
                "idDifficulte": 1,
                "difficulte": "Facile"
        },
        {
                "idDifficulte": 2,
                "difficulte": "Moyenne"
        },
        {
                "idDifficulte": 3,
                "difficulte": "Difficile"
        }
];
        
        // Affichage dans la console
        console.log("=== DONNÉES TO-DO LIST ===");
        console.log("Tâches:", listeTaches);
        console.log("Priorités:", listePriorites);
        console.log("Statuts:", listeStatuts);
        console.log("Catégories:", listeCategories);
        console.log("Difficultes:", listeDifficultes);

        // Permet d'exécuter la fonction uniquement lorsque tout le code est chargé ==> sinon erreur
        document.onreadystatechange = function () {
                if (document.readyState === "complete"){

                        displayListeTaches();
                }
        };

    // Afficher les tâches enregistrées
    function displayListeTaches(){
        // Crée un tableau HTML avec écriture dynamique
       let creationTableau="<table><thead><tr><th>Nom de la tâche</th><th>Description</th><th>Date de création</th><th>Date d'échéance</th><th>Localisation</th><th>Catégorie</th><th>Statut</th><th>Priorité</th><th>Difficulté</th></tr></thead><tbody>";

        // Crée une fonction pour récupérer les Id correspondant pour chaque élément
        listeTaches.forEach(function(item,index){
            let searchedIdCategorie= item.idCategorie;
            let foundCategorie= listeCategories.find(categorieItem => categorieItem.idCategorie==searchedIdCategorie).categorie;
            let searchedIdStatut= item.idStatut;
            let foundStatut= listeStatuts.find(statutItem => statutItem.idStatut==searchedIdStatut).statut;
            let searchedIdPriorite= item.idPriorite;
            let foundPriorite= listePriorites.find(prioriteItem => prioriteItem.idPriorite==searchedIdPriorite).priorite;
            let searchedIdDifficulte= item.idDifficulte;
            let foundDifficulte= listeDifficultes.find(difficulteItem => difficulteItem.idDifficulte==searchedIdDifficulte).difficulte;
            creationTableau+=`<tr><td>${item.libelle}</td><td>${item.description}</td><td>${item.dateCreation}</td><td>${item.dateEcheance}</td><td>${item.localisation}</td><td>${foundCategorie}</td><td>${foundStatut}</td><td>${foundPriorite}</td><td>${foundDifficulte}</td></tr>`;
        });
        
        creationTableau+="</tbody></table>";
        document.querySelector("#main").insertAdjacentHTML('afterbegin',creationTableau);
    }
    
        function retour(){
        document.getElementById('backButton').addEventListener('click', () => {
                location.href="https://ch.dranebois.worldlite.fr/M2/web_todo/3B_test.html";
            });
    }
    
    </script>
</head>
<body>
    <div>
        <header>
            <h1>✨ Ma To Do Liste ✨ </h1>
            <p class="subtitle">Organisez votre journée avec style</p>
        </header>

        <section id="main">
            
        </section>
        
        <button id="backButton" type="button" onclick="retour()">Créer une nouvelle tâche</button>

        <footer>
             <p>© 2025 SYNVA M2. Créé par Charlie DRANEBOIS, Daria KOROTAEVA, Islem OUESLATI et Oumaima SARIM</p>
        </footer>
    </div>
</body>
</html>
